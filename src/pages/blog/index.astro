---
import BaseLayout from '../../layouts/BaseLayout.astro';
import butter from '../../lib/buttercms';

// Fetch posts from ButterCMS
let posts: any[] = [];
let error = null;

if (butter) {
  try {
    const response = await butter.post.list({ page: 1, page_size: 20 });
    posts = response?.data?.data || [];
  } catch (e) {
    console.error('Error fetching posts from ButterCMS:', e);
    error = e;
  }
}
---

<BaseLayout
  title="Blog & Insights"
  description="Insights on digital transformation in African education. Implementation strategies, success stories, digital literacy best practices, and open-source technology for schools."
  keywords="education technology blog, digital transformation insights, African education news, school technology implementation, digital literacy strategies, open-source education, education technology case studies"
>
  <div class="max-w-[1000px] mx-auto px-4 sm:px-6 py-6 sm:py-8">
    <div class="text-center mb-8 sm:mb-12 md:mb-16 py-8 sm:py-10 md:py-12 px-4">
      <h1 class="text-[clamp(1.75rem,6vw,3rem)] font-extrabold font-serif text-[var(--primary)] mb-3 sm:mb-4">Framework Insights & Updates</h1>
      <p class="text-[clamp(1rem,2.5vw,1.25rem)] text-[var(--text-secondary)]">Exploring digital transformation in education, implementation strategies, and success stories</p>
    </div>

    {error && (
      <div class="bg-[var(--bg-surface)] p-6 rounded-xl border border-red-500 text-center mb-8">
        <p class="text-[var(--text-secondary)]">Unable to load posts. Please try again later.</p>
      </div>
    )}

    {posts.length === 0 && !error && (
      <div class="bg-[var(--bg-surface)] p-6 rounded-xl text-center mb-8">
        <p class="text-[var(--text-secondary)]">No blog posts available yet. Check back soon!</p>
      </div>
    )}

    <div class="grid gap-4 sm:gap-6 md:gap-8">
      {posts.map((post) => (
        <article class="bg-[var(--bg-surface)] p-5 sm:p-6 md:p-8 rounded-xl shadow-sm transition-all duration-200 hover:-translate-y-1 hover:shadow-lg">
          <div class="text-[var(--text-secondary)] text-xs sm:text-sm mb-2 sm:mb-3">
            {new Date(post.published).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
          </div>
          <h2 class="text-[clamp(1.15rem,4vw,1.75rem)] leading-tight mb-3 sm:mb-4">
            <a href={`/blog/${post.slug}`} class="text-[var(--text)] no-underline transition-colors hover:text-[var(--primary)]">
              {post.title}
            </a>
          </h2>
          <p class="text-sm sm:text-base text-[var(--text-secondary)] leading-relaxed mb-4 sm:mb-6">{post.summary}</p>
          {post.featured_image && (
            <img
              src={post.featured_image}
              alt={post.featured_image_alt || post.title}
              class="w-full h-48 object-cover rounded-lg mb-4"
            />
          )}
          <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 sm:gap-0 pt-3 sm:pt-4 border-t border-[var(--border)]">
            <span class="text-[var(--text-secondary)] text-xs sm:text-sm">
              By {post.author?.first_name} {post.author?.last_name}
            </span>
            <a href={`/blog/${post.slug}`} class="text-[var(--primary)] no-underline font-semibold text-sm sm:text-base transition-colors hover:brightness-110">
              Read more â†’
            </a>
          </div>
        </article>
      ))}
    </div>
  </div>
</BaseLayout>
